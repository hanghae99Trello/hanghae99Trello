<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>할일헤븐</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/board_style.css}" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arbutus+Slab" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.js"></script>
    <script type="text/javascript" th:src="@{/js/board_js.js}"></script>
</head>
<body>
    <div class="board_container" th:data-board-id="${boardId}">
        <div id="p1" class="mdl-progress mdl-js-progress"></div>
        <div class="kanban__title">
            <h1>
                <i class="material-icons">check</i> To do list
            </h1>
        </div>
        <div class="flex_container">
            <div class="dd" th:each="column : ${board.colList}">
                <ol class="kanban To-do">
                    <div class="kanban__title">
                        <h2 th:text="${column.colName}">Column Name</h2>
                    </div>
                    <li class="dd-item">
                        <h3 class="title dd-handle">
                            <span></span>
                        </h3>
                        <div class="actions">
                            <button class="addbutt">
                                <i class="material-icons">control_point</i> Add new
                            </button>
                        </div>
                    </li>
                </ol>
            </div>
        </div>
        <menu class="kanban">
            <button>
                <i class="material-icons">settings</i>
            </button>
            <button>
                <i class="material-icons">chevron_left</i>
            </button>
            <button class="viewkanban">
                <i class="material-icons ">view_column</i>
            </button>
            <button class="viewlist">
                <i class="material-icons">view_list</i>
            </button>
            <button class="add-column-button" onclick="openForm()">
                <i class="material-icons">playlist_add</i> Add new Column
            </button>
        </menu>

        <div class="popup-form" id="columnForm">
            <form id="addBoardForm">
                <div id="formErrorMessage" style="font-weight: 100; color: red; margin-bottom: 10px;"></div>
                <input type="text" id="colName" name="colName" placeholder="Column Name" required><br>
                <input type="text" id="colIndex" name="colIndex" placeholder="Column Index" required><br>
                <!-- 추가 폼 요소들을 필요에 따라 추가할 수 있습니다 -->
                <button type="button" onclick="submitForm()">Create Column</button>
                <button type="button" onclick="closeForm()">Close</button>
            </form>
        </div>
    </div>
    <script>
        document.querySelector('#p1').addEventListener('mdl-componentupgraded', function() {
            this.MaterialProgress.setProgress(44);
        });
        function openForm() {
            document.getElementById("columnForm").style.display = "block";
        }

        function closeForm() {
            document.getElementById("columnForm").style.display = "none";
        }

        function submitForm() {
            // 이 부분에서 보드 ID를 가져옴
            const boardContainer = document.querySelector('.board_container');
            const boardId = boardContainer.getAttribute('data-board-id');

            const colName = document.getElementById("colName").value;
            const colIndex = document.getElementById("colIndex").value;

            const data = {
                colName: colName,
                colIndex: colIndex
            };

            // Ajax 호출
            fetch(`/api/users/boards/${boardId}/columns`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    closeForm();
                    location.reload();
                })
                .catch((error) => {
                    console.error('Error:', error);
                    document.getElementById("formErrorMessage").textContent = "Error creating column.";
                });
        }

    </script>
</body>
</html>